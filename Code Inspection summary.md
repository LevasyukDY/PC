# Инспекция кода

Инспекция кода (ревизия кода, рецензия кода, Code review) – это систематическая проверка исходного кода программы. Цель проверки – обнаружение и исправление ошибок, которые были пропущены, остались незамечены при разработке. Результат инспекции как правило – улучшение качество ПО и навыки разработчика.

В ходе инспекции, когда могут быть найдены, с последующим устранением, такие уязвимости, как ошибки в форматировании строк, утечка памяти, переполнение буфера, что улучшает безопасность ПО. Системы контроля версий также дают возможность проведения совместной инспекции исходного кода. Помимо этого, есть инструменты, которые предназначены именно для совместной инспекции.

##### Существует множество примеров, когда совместная инспекция кода улучшила программный проект:

- Blender — пакет для создания трёхмерной компьютерной графики, значительно улучшенный open-source сообществом;
- Ядро Linux, разработка которого была начата финским студентом Линусом Торвальдсом.



## На что следует обратить внимание.

#### Архитектура/Дизайн.

- Принцип «одной ответственности».

  Идея в том, что у каждого класса должно быть только одно назначение. На самом деле реализовать это труднее, чем кажется. Я обычно применяю это правило и к методам. Если возникает нужда в союзе «и» при описании того, что делает метод, то это знак, что стоит разделить его на несколько более простых.

- Дупликация кода.

  Если один и тот же кусок используется три раза или больше, то необходимо вынести его в отдельный метод.

- Принцип «Открыт/Закрыт».

  Если язык объектно-ориентированный, то открыты ли ваши объекты для расширения, но закрыты для модификации? Что произойдет, если нам нужно будет добавить еще один экземпляр класса?

- При изменении кода всегда пытайтесь его улучшить.

- Обработка ошибок.

- Эффективность.

  #### Стиль.

- Имена методов.

  Давать имена различным вещам — одна из самых сложных задач в программировании. Если метод называется `get_message_queue_name()`, но делает что-то кроме этого, например, убирает HTML из входных данных, тогда это имя не подходит ему.

- Документация.

  Сложные методы лучше задокументировать так, чтобы было понятно, за что отвечает каждый аргумент.

- Длина классов.

  Классы должны быть меньше 300 строк, а в идеале — меньше 100. Скорее всего, если в вашем коде есть длинные классы, то их можно разбить на несколько, что облегчит понимание их предназначения.

- Длина файла. 

  Для Python 1000 строк в одном файле — предел. Если их становится больше, то, возможно, стоит разбить файл на несколько, с более специфичным предназначением. Чем больше файл, тем меньше читабельность кода в нем.

  #### Тестирование.

- Полнота тестов.

  Мне нравится, когда нововведения тестируются. Но насколько эти тесты продуманы? Могут ли они заставить ваш код упасть? Легко ли они читаются? Насколько они хрупки? Насколько они большие? Медленные ли они?

- Тестирование на правильном уровне.  

  Тестируется ли тот уровень приложения, который нужно тестировать для проверки функциональности? Гарри Бернардт рекомендует такое соотношение — 95% юнит-тестов и 5% интеграционных тестов.

- Соответствование требованиям. 

  Обычно в конце инспектирования я смотрю на задачу или баг, для которого был предназначен тест. Если он не соответствует каким-то критериям, то лучше провести тестирование заново.

  

## Проинспектируйте свой код сами.

Перед совершением коммита просмотрите свой код на следующие вещи:

- Оставили ли вы какие-нибудь комментарии или TODO?
- Говорят ли сами за себя имена переменных?

- и т.д.

Я хочу быть уверенным в том, что код пройдет мое собственное инспектирование перед тем, как его будут оценивать другие люди, чтобы не создавать им лишней работы.



## Как проводить инспектирование кода.

Человеческий фактор при инспектировании порой приносит не меньше проблем, чем само инспектирование.

Несколько приемов для проведения таких мероприятий:

- Задавайте вопросы. 

  Задавайте вопросы, которые подтолкнут разработчиков к обсуждению. Например, как работает этот метод? Если изменится какое-то требование, то что нужно будет поменять в коде? Как сделать код более поддерживаемым?

- Обсуждайте детали наедине. 

  Большие архитектурные изменения лучше обсуждать всей командой, в то время как про мелкие детали лучше говорить наедине с разработчиком, который ответственен за них, дабы не вовлекать лишних людей.

- Дело в коде.

   Обсуждайте сам код, а не разработчиков, которые его писали. Это создаcт непринужденную атмосферу, тем более, программисты ни при чем — инспектирование призвано улучшить качество кода.

- Объясняйте причины.

  Всегда лучше рассказать или спросить, почему предложенные изменения необходимы. Порой может возникнуть чувство, что они несущественны, до тех пор, пока вы не объясните повод.



#### Источники:

- https://ru.wikipedia.org/wiki/Просмотр_кода - Википедия
- https://tproger.ru/translations/code-review-best-practices/ - tproger.ru